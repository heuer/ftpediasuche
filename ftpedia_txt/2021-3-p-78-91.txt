

Computing

Experimente mit dem Kombisensor
Dirk Fox
Im Jahr 2018 brachte fischertechnik einen IMU (Inertial Measurement Unit) auf den Markt,
der via IÂ²C-Protokoll mit dem TXT verbunden werden kann â€“ den â€Kombisensorâ€œ (158402).
Eine etwas unglÃ¼ckliche Bezeichnung, verrÃ¤t sie doch nicht, was der Sensor alles kann.
ZunÃ¤chst war er nur mit dem Education-Baukasten â€Robotics Competition Setâ€œ erhÃ¤ltlich;
inzwischen gibt es ihn auch als Einzelteil. TatsÃ¤chlich ist damit einiges mÃ¶glich...

Hinter den Kulissen
Der fischertechnik-Kombisensor [1] enthÃ¤lt
das Bosch-Sensormodul BMX055, das
einen Magnetsensor, einen Beschleunigungssensor und einen Gyrosensor umfasst
[2]. Dank der vielen Milliarden Smartphones erhÃ¤lt man solche â€“ frÃ¼her koffergroÃŸen, Inertial Measurement Unit (IMU)
[3] genannten â€“ Sensor-Kombinationen
heute fÃ¼r einen kleinen zweistelligen EuroBetrag, integriert auf einem wenige
Quadratmillimeter groÃŸen IC.
Der Kombisensor von fischertechnik ist
zusÃ¤tzlich mit einem Step-Down-Wandler
ausgestattet, der die 9V-Spannung des TXT
auf die von den Sensoren benÃ¶tigten 3,3V
herunterregelt.
Im Einzelteilvertrieb kostet der Kombisensor 48 bis 58 Euro.

Magnet-, Beschleunigungs- und Gyro-Sensor des BMX055 sind dreidimensional, d. h.
sie liefern Messwerte fÃ¼r je drei zueinander
senkrechte x-, y- und z-Achsen.
Der Beschleunigungssensor ist vermutlich
ein BMA253 oder VorlÃ¤ufer (Chip-ID
0xFA), erreichbar unter der IÂ²C-Adresse
0x18. Er liefert mit 12 bit AuflÃ¶sung und
einer Genauigkeit von 1 mğ‘” die Beschleunigung im VerhÃ¤ltnis zur zwei- bis 16ğ‘š
fachen Erdbeschleunigung ğ‘” = 9,81 2.
ğ‘ 

Der mit dem BMM050 und BMM150 kompatible Magnetometer (â€Kompasssensorâ€œ)
hÃ¶rt auf die IÂ²C-Adresse 0x10 und liefert die
x-, y- und z-Komponente der gemessenen
magnetischen Flussdichte in ÂµT mit einer
Genauigkeit von 0,3 ÂµT u. 13 bit AuflÃ¶sung.
Der Gyrosensor ist unter der IÂ²C-Adresse
0x68 ansprechbar und misst die Winkelgeschwindigkeit einer Drehung des Sensors
um die x-, y- und z-Achse in Â°/s. Die Messwerte haben eine AuflÃ¶sung von 16 bit.

Anschluss an den TXT



Am Robotics TXT Controller wird der Sensor mit dem beiliegenden 10-poligen Flachbandkabel an den EXT-Ausgang angeschlossen. Als Stromversorgung dient ein
einadriges Kabel, Ã¼ber das der 9V-Eingang
des Sensors mit dem 9V-Ausgang des
Controllers verbunden wird (Abb. 2).


Computing

die 3V-Logik des Sensors mit der 5V-Logik
des TX zu verbinden. AuÃŸerdem muss man
beachten, dass die Anschlussbelegung des
TXT 4.0 von der des ebenfalls sechspoligen
EXT-2-Anschlusses des TX-Controllers
abweicht: Dort sind Pin 1 (GND) und Pin 2
(5V) genau umgekehrt belegt. Vorsicht also
mit alten â€vorkonfektioniertenâ€œ Kabelnâ€¦

Programmierung


Der Sensor kann auch am neuen Robotics
TXT 4.0 Controller genutzt werden. Dort ist
fischertechnik wieder zu einer sechspoligen
Wannenbuchse (wie beim TX Controller)
zurÃ¼ckgekehrt. Die Verbindung zwischen
einem der beiden EXT-AusgÃ¤nge des Controllers und dem Sensor kann man entweder
mit einem Adapterkabel oder mit drei
Female-to-Female-Jumper-Kabeln herstellen. Die folgende Grafik zeigt die zu verbindenden AnschlÃ¼sse (Abb. 3).

Robotics TXT 4.0 Controller

Die Stromversorgung wird auch hier mit
einem einadrigen Kabel zwischen dem 9VEingang des Sensors und dem 9V-Ausgang
des Controllers hergestellt.
Wer noch einen TX Controller sein eigen
nennt, der benÃ¶tigt einen Level-Shifter, um

FÃ¼r ROBO Pro hat fischertechnik einen IÂ²CTreiber fÃ¼r den Sensor BMX055 â€“ genauer:
die drei darin enthaltenen Sensoren â€“ entwickelt, der seit Version 4.2.4 mit der
ROBO Pro-Software ausgeliefert wird. Den
Treiber findet man in der ROBO ProBibliothek unter â€šI2Câ€˜.
Daher kÃ¶nnen wir uns im Folgenden zunÃ¤chst auf die Nutzung dieser Bibliothek
beschrÃ¤nken. TatsÃ¤chlich musste ich sie
Ã¼berarbeiten und erweitern, weil sie einige
Fehler enthÃ¤lt, die Temperaturkompensation der z-Achse des Magnetometers nicht
implementiert wurde und eine Kalibrierung
fehlt (mehr dazu spÃ¤ter). Technische Details
zur Konfiguration und Nutzung der drei
Sensoren finden sich im 172-seitigen
Datenblatt von Bosch zum BMX055 [2].
FÃ¼r die neue fischertechnik-Programmierumgebung ROBO Pro Coding (vulgo:
Blockly) stellt fischertechnik ebenfalls spezielle Blockly-Befehle bereit, die die Daten
des Kombisensors auslesen. Alle folgenden
Anwendungsbeispiele lassen sich weitgehend auch in ROBO Pro Coding implementieren. Wegen der groÃŸartigen OszilloskopFunktion, die es (bisher) in ROBO Pro
Coding nicht gibt, habe ich mich bei den
Beispielprogrammen allerdings auf ROBO
Pro beschrÃ¤nkt.
Damit die Daten auf dem Oszilloskop im
Bedienfeld angezeigt werden, mÃ¼ssen die
Programme im Online-Mode gestartet werden. Im WLAN-Mode (mit dem TXT als
WLAN-Client) funktioniert das auch kabellos. Und im Klassenraum kann man die
Messergebnisse via Beamer projizieren.


Beschleunigungssensor
Der Beschleunigungssensor misst in Ruhelage die Erdbeschleunigung ğ‘”: Liegt der
Sensor flach auf einem Tisch, so liegt an der
nach oben gerichteten z-Achse 1ğ‘” an (1.000
mğ‘”), wÃ¤hrend die x- und y-Komponente
deutlich kleinere Werte liefern. Das kann
man sich sehr anschaulich mit der Oszilloskop-Funktion in ROBO Pro anzeigen lassen
(Abb. 4).

Der fischertechnik-Treiber liefert als Rohdaten 16-bit-Werte, bei denen die niederstwertigen vier Bits undefiniert sind (also
beliebige Daten enthalten kÃ¶nnen). Durch
einen arithmetischen Shift um vier Bits
korrigieren wir daher die Werte gleich nach
dem Einlesen (Abb. 6).

[Skala: 1s/0,25ğ‘”]
(Programm: Acc-Oszilloskop.rpp)

Dreht man den Sensor nun in verschiedene
Richtungen um 90Â°, kann man die Ausrichtung der x- und der y-Achse prÃ¼fen: Zeigt
das Oszilloskop 1ğ‘” an, so ist die entsprechende Sensor-Achse gerade nach oben gerichtet. Die Orientierung der Achsen zueinander lÃ¤sst sich leicht mit der â€RechteHand-Regelâ€œ merken [2] (Abb. 5).

Beschleunigungssensors

Um aus den Rohdaten den Wert in mğ‘” zu
erhalten, mÃ¼ssen wir diese noch nach Tab.
1 abhÃ¤ngig von dem bei der Initialisierung
gewÃ¤hlten Messintervall umrechnen [2]:

Tab. 1: Umrechnung der Rohdaten


Mit einem Aufkleber kÃ¶nnt ihr die Lage der
x- und der y-Achse auf dem Sensor kennzeichnen (siehe Abb. 2).


Bei einem Messintervall von Â±2ğ‘” verwendet der Sensor fÃ¼r die Darstellung von 1.000
mğ‘” 1.024 bit â€“ also mÃ¼ssen wir die Rohdaten durch 1,024 dividieren (oder mit
0,9766 multiplizeren), um die Werte in der
Einheit mğ‘” zu erhalten. Bei Â±4ğ‘” mÃ¼ssen
wir durch 0,512 dividieren, bei Â±8ğ‘” durch
0,256 und bei Â±16ğ‘” durch 0,128 (oder mit
7,8125 multiplizieren). Dieser Schritt wird
auch als â€šSkalierungâ€˜ bezeichnet.
Was kann man nun mit einem solchen Beschleunigungssensor anfangen?


Computing

NatÃ¼rlich kann man mit ihm Beschleunigungen messen. Das macht man z. B. zur
Bestimmung von kaum wahrnehmbaren Vibrationen (bspw. in Kameras und in Seismografen, siehe Abb. 7) oder von besonders
groÃŸen wie der negativen Beschleunigung
bei einer Bremsung, einem Crash-Test oder
in einer Zentrifuge. Auch beim AuslÃ¶sen
eines Airbags kommen Beschleunigungssensoren zum Einsatz, ebenso bei der Erkennung des â€Antippensâ€œ eines Smartphones (plÃ¶tzliche sehr kurze Beschleunigung).

â€Passantenâ€œ in der Wohnung erzeugten
Vibrationen [Skala: 1s/0,01ğ‘”]

Pendelexperiment
Wir kÃ¶nnen mit dem Sensor auch physikalische Experimente durchfÃ¼hren. Ein hÃ¼bsches, einfaches Experiment ist der Nachweis der Ã¼berraschenden Erkenntnis von
Galileo Galilei (1564â€“1642) aus dem Jahr
1632, dass die Schwingungsperiode ğ‘‡ eines
Pendels allein von der LÃ¤nge ğ‘™ des Pendels
abhÃ¤ngt und unabhÃ¤ngig ist von Gewicht
und Auslenkung. Es gilt:
ğ‘‡ =2âˆ™ğœ‹âˆ™

ğ‘™
ğ‘”

Stellen wir die Gleichung um, kÃ¶nnen wir
zu einer gewÃ¼nschten Periodendauer ğ‘‡ die
dafÃ¼r erforderliche PendellÃ¤nge bestimmen:
ğ‘‡ 2
2âˆ™ğœ‹
Ein Pendel, das wie bei einer Standuhr [4]
einmal pro Sekunde den tiefsten Punkt passiert (PeriodenlÃ¤nge ğ‘‡ = 2 s), muss eine
LÃ¤nge ğ‘™ von knapp einem Meter (genauer:
99,4 cm) haben. HÃ¤ngen wir nun den TXT
mit einem Haken und seitlich angebrachtem
Kombi-Sensor an einen entsprechend langen Faden (gemessen bis zur Mitte des
Controllers) und lassen ihn pendeln, zeigt
das Oszilloskop fÃ¼r die nach oben gerichtete
Achse die Schwingung in Abb. 8 an.
ğ‘™=ğ‘”âˆ™

Den niedrigsten Beschleunigungswert misst
der Sensor, wenn der TXT nach unten
schwingt; wenn er senkrecht hÃ¤ngt und in
den â€Wendepunktenâ€œ entspricht der Wert
der Erdbeschleunigung. Man kann sehr
schÃ¶n erkennen, wie die Amplitude der
Schwingung abnimmt, wÃ¤hrend die LÃ¤nge
der Periode der Sensorwerte konstant bei
einer Sekunde liegt.
Nun kÃ¶nnt ihr leicht ausrechnen (und anschlieÃŸend mit dem TXT-Pendel und dem
Programm in Abb. 9 experimentell Ã¼berprÃ¼fen), wie lang das Pendel einer Uhr mit
einer Periode von bspw. ğ‘™ = 1 s sein muss.
(Zugegeben, das Experiment funktioniert
natÃ¼rlich auch ohne TXT und Kombisensor
ganz einfach mit Pendel und Stoppuhr oder
einer Uhr mit Sekundenzeiger. DafÃ¼r wird
hier die Schwingung mit Amplitude sehr
anschaulich sichtbar gemacht.)

(Programm: Pendelexperiment.rpp, siehe Abb. 9)




Neigungsmessung
Eine weitere wichtige Anwendung von Beschleunigungssensoren ist die Lagebestimmung (Neigungswinkel oder â€Tiltâ€œ).
Die Neigung des Sensors wird in zahlreichen Anwendungen genutzt: In Flugzeugen, Hubschraubern, Multicoptern und Raketen ist sie ein Kernelement der Navigation. Mit einem Gimbal kann eine Kamera
an einem bewegten Objekt in konstanter
Ausrichtung gehalten werden. Und auch bei
der HÃ¶henmessung in der GeodÃ¤sie ist die
exakte Bestimmung des Neigungswinkels
zum Erdmagnetfeld wichtig. SchlieÃŸlich
kÃ¶nnen wir die Neigung â€“ wie beim Nunchuk [5] oder der Smartphone-Steuerung
fÃ¼r den Flitzer [6] â€“ als Fernsteuerung fÃ¼r
ein Modell nutzen.

Die Neigung wird durch zwei Winkel definiert, die â€“ wie in der Luftfahrt Ã¼blich â€“ als
â€Rollâ€œ (Drehung im Uhrzeigersinn um die
in Flugrichtung zeigende x-Achse) und
â€Pitchâ€œ (Drehung um den rechten FlÃ¼gel,
ebenfalls im Uhrzeigersinn) bezeichnet
werden. Die Winkel werden dabei jeweils
in Bezug auf eine horizontale Fluglage bestimmt (Abb. 10).




Computing

Auch bei Flugzeugen sind die Beschleunigungsachsen nach der Rechte-Hand-Regel
(Abb. 5) ausgerichtet, allerdings zeigt hier
die z-Achse nach unten; das Koordinatensystem ist um 180Â° um die x-Achse gedreht.
Die Drehung um die z-Achse wird â€Yawâ€œ
oder â€Headingâ€œ genannt. Nur mit dem Beschleunigungssensor kÃ¶nnen wir jedoch
keinen Bezugswert fÃ¼r das Heading festlegen (wie die horizontale Lage fÃ¼r Pitch und
Roll): Um die Abweichung von der Ausrichtung auf den geomagnetischen Nordpol
zu bestimmen, benÃ¶tigen wir zusÃ¤tzlich
einen Kompasssensor (Magnetometer) [7].
Nun mÃ¶chten wir zunÃ¤chst Pitch und Roll
aus den Werten unseres Kombisensors berechnen. Die Herleitung der Formel spare
ich mir â€“ das ist einfache Trigonometrie.
Eine sehr schÃ¶ne Darstellung findet sich
z. B. in [8]. Im Folgenden bezeichnen der
Winkel ğœƒ Roll, der Winkel ğœ‘ Pitch und
ğ´ğ‘ğ‘ğ‘¥ , ğ´ğ‘ğ‘ğ‘¦ und ğ´ğ‘ğ‘ğ‘§ die vom Sensor
gemessene x-, y- und z-Komponente der
Beschleunigung. Damit gilt [8, 9]:
tan ğœƒ =
tan ğœ‘ =


Auf die Berechnung von ğœƒ hat die Drehung
des Koordinatensystems keinen Einfluss;
beim Pitch hingegen mÃ¼ssen wir das Vorzeichen des Ergebnisses invertieren (Abb.
12).

ğ´ğ‘ğ‘ğ‘¦
ğ´ğ‘ğ‘ğ‘§

âˆ’ğ´ğ‘ğ‘ğ‘¥
ğ´ğ‘ğ‘ğ‘¦ âˆ™ sin ğœƒ + ğ´ğ‘ğ‘ğ‘§ âˆ™ cos ğœƒ

Da der Tangens nur zwischen -90Â° und 90Â°
definiert ist, berechnen wir ğœƒ und ğœ‘ nicht
mit der Arkustangens- sondern der ğ‘ğ‘¡ğ‘ğ‘›2Funktion (Abb. 11), die mit zwei Eingabewerten (ğ‘¥, ğ‘¦) rechnet und einen Winkel
zwischen -180Â° und +180Â° liefert [10].


Sensor auf zwei im 90Â°-Winkel zueinander
versetzten Winkelsteinen 7,5 montiert wird.

montiert wird [Skala: 1s/1Â°] (Programm: Berechnung von Pitch und Roll.rpp, siehe Abb. 14)



Betrag des Beschleunigungsvektors etwa
1ğ‘” entspricht [11]:

ğ´ğ‘ğ‘ğ‘¥ 2 + ğ´ğ‘ğ‘ğ‘¦ 2 + ğ´ğ‘ğ‘ğ‘§ 2 = 1000 mğ‘”

Diese Bedingung kÃ¶nnen wir auch im Programm prÃ¼fen (Variable â€Testâ€œ in Abb. 14).
Mit den Werten von Pitch und Roll kÃ¶nnen
wir nun eine Neigungssteuerung implementieren oder mit Servos einen Gimbal steuern. Wie das geht, werde ich in einem
separaten Beitrag vorstellen.

Magnetometer

(Programm: Berechnung von Pitch und
Roll.rpp)

Im ROBO Pro-Programm zur Berechnung
von Pitch und Roll in Abb. 14 sind die drei
Schritte gut zu erkennen:
ï‚· Auslesen der Rohdaten des Sensors
ï‚· Skalierung auf mğ‘”
ï‚· Berechnung der Winkel ğœƒ und ğœ‘
Wenn der Pitch sich 90Â° nÃ¤hert, steigt der
Wert von Roll plÃ¶tzlich ebenfalls stark an.
Das kÃ¶nnt ihr mit dem Programm selbst
ausprobieren, indem ihr den Sensor um die
x-Achse dreht. Dieser Effekt ist dem
Berechnungsverfahren geschuldet, bei dem
im â€Randbereichâ€œ das Rauschen des Sensors grÃ¶ÃŸere Fehler induziert [9]. Da unsere
Pitch-Werte eher im Bereich bis Â±45Â° liegen
betrifft uns das allerdings nicht weiter.
FÃ¼r die Korrektheit des Ergebnisses ist es
wesentlich, dass sich der Sensor in Ruhe
befindet, also keine andere Beschleunigung
als die der Erdanziehungskraft auf ihn
wirkt. Das erkennen wir daran, dass der

Die vom Magnetometer des Kombisensors
gemessene Magnetflussdichte des Erdmagnetfelds liegt auf der ErdoberflÃ¤che zwischen 22 und 67 ÂµT und ist auf den geomagnetischen Nordpol ausgerichtet. Genau
genommen ist es magnetisch ein SÃ¼dpol â€“
sonst wÃ¼rde die Kompassnadel nicht nach
Norden zeigen. An den geomagnetischen
Polen sinkt die Magnetflussdichte auf 0 ÂµT.
Deklination
TatsÃ¤chlich ist das Erdmagnetfeld ungleichmÃ¤ÃŸig und stimmen die geomagnetischen
nicht mit den geografischen Polen Ã¼berein,
sodass es zu Abweichungen zwischen der
Richtung der Kompassnadel und dem geografischen Nordpol kommt. Diese sogenannte Deklination wurde erstmalig von
dem Chinesen Yi Xing (683-727) im Jahr
720 gemessen. Sie ist zudem nicht stabil,
denn das Erdmagnetfeld unterliegt permanenten Ã„nderungen und wird auch â€“ sogar
im Tagesverlauf â€“ vom Sonnenwind beeinflusst. In Deutschland liegt die Deklination
derzeit bei etwa 1-4Â° Ost; das ist sehr wenig
im Vergleich mit Gegenden in PolarnÃ¤he.
Wir vernachlÃ¤ssigen die Deklination daher
und konzentrieren uns darauf, die magnetische Nordrichtung zu bestimmen.
Inklination
Das Erdmagnetfeld wirkt auch nicht Ã¼berall
parallel zur ErdoberflÃ¤che. Den Winkel, in

dem die Wirkung (die magnetischen Feldlinien) gegenÃ¼ber der Horizontalen geneigt
ist, nennt man Inklination. Sie wurde erstmalig im Jahr 1544 von dem deutschen
Mathematiker Georg Hartmann (14891564) beschrieben. Am Ã„quator betrÃ¤gt sie
0Â°, an den geomagnetischen Polen 90Â°. In
Deutschland liegt sie immerhin bei 62Â° bis
70Â°. Sie beeinflusst allerdings unsere folgenden Rechnungen nicht, daher werden
wir auch sie ignorieren.
Auslesen der Rohdaten
Beim Auslesen der Sensor-Rohdaten des
Magnetometers mÃ¼ssen wir berÃ¼cksichtigen, dass die x- und y-Komponente jeweils
13 bit, die z-Komponente jedoch 15 bit
umfasst. Wie beim Beschleunigungssensor
shiften wir die Rohdaten zunÃ¤chst, bevor
wir sie weiter verarbeiten (Abb. 15); das
wurde im fischertechnik-Treiber vergessen.

Computing

enthÃ¤lt der ROBO Pro-Treiber von fischertechnik dafÃ¼r bereits eine Funktion â€“ hier
mÃ¼ssen wir daher zunÃ¤chst nichts weiter
berÃ¼cksichtigen.
Die z-Komponente benÃ¶tigen wir bei den
folgenden Anwendungen nicht. Diese im
fischertechnik-Treiber fehlende Temperaturkompensation habe ich in meiner Implementierung fÃ¼r spÃ¤tere Anwendungen ergÃ¤nzt.
Rauschen
Die Rohdaten des Magnetometers schwanken sehr stark. Das lÃ¤sst sich mit einem einfachen Filter wie dem gleitenden Durchschnitt Ã¼ber mehrere Messwerte verringern
(Abb. 16).

Magnetometers

Temperaturkompensation
Bevor wir die Rohdaten des Magnetsensors
auswerten kÃ¶nnen mÃ¼ssen wir eine Temperaturkompensation vornehmen, da sich die
Messwerte bei der ErwÃ¤rmung des Sensors
verÃ¤ndern. FÃ¼r die x- und y-Komponente

Rohwerte der y-Komponente (Magnetsensor)



Mit einem Kalman-Filter gelingt das wahrscheinlich noch besser; fÃ¼r viele Zwecke
genÃ¼gt unser Filter jedoch. Dabei ist
allerdings zu beachten, dass sich sprunghafte Ã„nderungen des Magnetfelds erst verzÃ¶gert bemerkbar machen â€“ bei 30 Messungen
pro Sekunde und einer Mittelwertbildung
Ã¼ber 20 Messwerte wirkt sich die Ã„nderung
erst nach rund 0,67 s voll aus.
Die Mittelwertbildung mÃ¼ssen wir fÃ¼r jede
der drei Komponenten vornehmen.
Kalibrierung
Der Sensor reagiert sehr empfindlich auf
StÃ¶rungen des Magnetfelds, die z. B. durch
ferromagnetisches Material verursacht werden. Solche konstanten StÃ¶rungen werden
als â€Hard Ironâ€œ-Fehler bezeichnet.
Die fischertechnik-Implementierung des
BMX055-Treibers berÃ¼cksichtigt diese
StÃ¶rungen nicht. Um die durch sie verursachten Messfehler zu korrigieren fÃ¼hrt
man Ã¼blicherweise nach dem Einbau eines
Sensors in ein Modell eine Kalibrierung
durch. Dazu genÃ¼gt es, den Sensor ein paar
Mal gleichmÃ¤ÃŸig um sich selbst zu drehen.
Dabei bestimmt man die maximalen und
minimalen MagnetfeldstÃ¤rken fÃ¼r die xund die y-Achse [12] (Abb. 17).

(Programm: Kalibrierung Hard Iron.rpp)

Man erkennt sofort, dass die Maximal- und
Minimalwerte der x- und der y-Achse nicht
Ã¼bereinstimmen â€“ die beiden Kurven sind
also zueinander und zur jeweiligen 0-Achse
verschoben. Die Verschiebung muss von
den (temperaturkompensierten) Rohdaten
des Magnetometers abgezogen werden,


bevor wir weiterrechnen und bspw. die Abweichung von der Nordausrichtung bestimmen. Das macht das Kalibrierungsprogramm, sobald der Taster an I1 gedrÃ¼ckt
wird.
Nach korrekter Kalibrierung sollten die xund y-Werte des Magnetometers beim Drehen um die eigene Achse einen einigermaÃŸen runden Kreis um den Nullpunkt
bilden; in der Oszilloskop-Darstellung mÃ¼ssen die Mittelpunkte der x- und der y-Kurve
auf der 0-Achse liegen.
Die Werte der Variablen â€CalXâ€œ und
â€CalYâ€œ solltet ihr anschlieÃŸend notieren:
Diese beiden Kalibrierungswerte gelten fÃ¼r
euer Modell.
Schwieriger herauszurechnen sind â€SoftIronâ€œ-Fehler, die sich mit der Position des
Sensors Ã¤ndern. Sie kÃ¶nnen bspw. von
stromdurchflossenen Leitern verursacht
werden. Wir ignorieren diese Fehler hier
und sorgen stattdessen dafÃ¼r, dass wir den
Sensor mÃ¶glichst weit von StromflÃ¼ssen
und anderen Magnetfeldern entfernt montieren.
Ausrichtung des Sensors
Norden ist Ã¼blicherweise die Richtung, in
der der Wert der x-Komponente des Magnetometers sein Maximum erreicht, und
Westen die, in der der Wert der y-Komponente maximal wird [13].
Beim BMX055 sind die Achsen des Magnetometers zwar ebenfalls nach der RechteHand-Regel angeordnet, allerdings ist auch
hier das Koordinatensystem gedreht: Die xAchse des Magnetometers liegt auf der yAchse des Beschleunigungssensors und die
y-Achse auf dessen negativer x-Achse
(Abb. 18).


Computing

Auch hier berechnen wir (wie bei der Lagebestimmung) die Umkehrung des Tangens
mit der Funktion ğ‘ğ‘¡ğ‘ğ‘›2 (Abb. 11).


Daher zeigt die x-Achse des Beschleunigungssensors nach SÃ¼den, wenn die yKomponente den maximalen Wert annimmt, und die y-Achse des Beschleunigungssensors nach Norden, wenn die xKomponente maximal ist. Das veranschaulicht das ROBO Pro-Programm â€MagOszilloskop.rppâ€œ.
Um die Werte des Magnetometers auf unser
nach der x-Achse des Beschleunigungssensors ausgerichtetes Koordinatensystem
abzubilden, definieren wir die folgenden
Kompass-Koordinaten:
ğ¶ğ‘œğ‘šğ‘ğ‘¥ : = âˆ’ğ‘€ğ‘ğ‘”ğ‘¦
ğ¶ğ‘œğ‘šğ‘ğ‘¦ : = ğ‘€ğ‘ğ‘”ğ‘¥
Liegt ein Kompass-Sensor in der horizontalen Ebene, dann ist die Bestimmung der
Abweichung ğœ“ von der Nordrichtung, das
â€Headingâ€œ (oder â€Yawâ€œ, d. h. die Drehung
der magnetischen x-Achse um die magnetische z-Achse im Uhrzeigersinn, Abb. 10)
einfach: Wir kÃ¶nnen sie direkt aus dem
Quotienten der y- und der x-Komponente
des Kompass-Sensors berechnen:
tan ğœ“ =

ğ¶ğ‘œğ‘šğ‘ğ‘¦
ğ¶ğ‘œğ‘šğ‘ğ‘¥

Die Funktion liefert uns einen Winkel
zwischen -180Â° und 180Â°: Damit lÃ¤sst sich
die Abweichung von der Nordrichtung im
Oszilloskop besser darstellen als mit den
360Â°-Werten, die die Funktion ğ‘€ğ‘ğ‘”ğºğ‘’ğ‘¡ğ´
des fischertechnik-Treibers zurÃ¼ckgibt. FÃ¼r
die Berechnung des Headings habe ich die
Funktion ğ‘€ğ‘ğ‘”ğºğ‘’ğ‘¡ğ´ des fischertechnikTreibers an unsere Sensor-Ausrichtung angepasst und in ğ‘€ğ‘ğ‘”ğºğ‘’ğ‘¡ğ»ğ‘’ğ‘ğ‘‘ğ‘–ğ‘›ğ‘” umbenannt.
Beim Vergleich der Berechnung mit den
korrigierten und kalibrierten Rohdaten
(Funktion
ğ‘€ğ‘ğ‘”ğºğ‘’ğ‘¡ğ¶ğ‘œğ‘šğ‘ğ¶ğ‘ğ‘™ğ»ğ‘’ğ‘ğ‘‘ğ‘–ğ‘›ğ‘”)
und der Berechnung mit der Funktion
ğ‘€ğ‘ğ‘”ğºğ‘’ğ‘¡ğ»ğ‘’ğ‘ğ‘‘ğ‘–ğ‘›ğ‘” des fischertechnik-Treibers ist in Abb. 20 gut zu erkennen, dass der
fischertechnik-Treiber (rote Linie) einen
Winkelfehler von etwa 8Â° verursacht. Je
nach Umgebung kann der Wert auch deutlich grÃ¶ÃŸer ausfallen. Da der fischertechnikTreiber auch keine Mittelwertbildung vornimmt, ist das Ergebnis des Treibers praktisch unbrauchbar.
Nach Kalibrierung und Mittelwertbildung
erreicht der Sensor eine Genauigkeit von
Â±0,5Â° â€“ leicht zu Ã¼berprÃ¼fen, indem wir den
TXT mit einem Kompass exakt nach Norden ausrichten (Abb. 19).

Beschleunigungssensors nach Norden (AccX)




Kombisensors ohne (rot) und mit (gelb) Kalibrierung sowie als gleitender Durchschnitt Ã¼ber 20
Messwerte mit Kalibrierung (grÃ¼n) [Skala: 1s/1Â°]
(Programm: Kalibrierte Kompass-Messung mit Mittelwertbildung.rpp)

Gyrosensor
Das Gyroskop im Kombisensor misst die
Geschwindigkeit einer Drehung um eine
oder mehrere der drei Achsen in Winkelgrad pro Sekunde. Diese Winkelgeschwindigkeit kann mit dem BMX055 in fÃ¼nf verschiedenen AuflÃ¶sungen gemessen werden:

Tab. 2: AuflÃ¶sungen des Gyrosensors [2]

Die AuflÃ¶sung wird bei der Initialisierung
eingestellt (default: 2000Â°/s). Die 16-bitRohdaten, die der Sensor liefert, mÃ¼ssen je
nach gewÃ¤hlter AuflÃ¶sung mit den in Tabelle 2 angegebenen Werten multipliziert werden, um den Wert der Winkelgeschwindigkeit in Tausendstel Â°/s zu erhalten, da wie
beim Beschleunigungssensor der Messbereich auf 215 Werte verteilt wird. Die
erhaltenen Rohdaten mÃ¼ssen wir exakt
durch 16,384 (bzw. 32,768/65,536/131,072
/262,144) dividieren (skalieren).

Die Winkelgeschwindigkeit einer Drehung
um die x- und y-Achse (Roll und Pitch) ist
insbesondere in Flugzeug-Autopiloten von
groÃŸer Bedeutung: Mit ihr lÃ¤sst sich ein
Ãœbersteuern verhindern. Mit dem Sensor
kann man aber auch Umdrehungsgeschwindigkeiten von Objekten (bspw. RÃ¤dern)
messen und regeln. Nachteil dieser Messmethode: Der Sensor â€“ wegen der Kabelverbindung damit in der Regel auch der
Controller â€“ muss sich mitdrehen.
In der Programmsammlung findet ihr das
â€Gyr-Oszilloskop.rppâ€œ, mit dem ihr euch
die Werte des Gyrosensors veranschaulichen kÃ¶nnt.
Messung der Zentripetalkraft
Ein sehr schÃ¶nes Physik-Experiment kÃ¶nnen wir mit dem Gyrosensor durchfÃ¼hren:
die Bestimmung der Zentripetalbeschleunigung und deren VerhÃ¤ltnis zur Winkelgeschwindigkeit. DafÃ¼r versetzen wir den
TXT mit seitlich montiertem Sensor in eine
immer schnellere Drehung und messen
dabei die Winkelgeschwindigkeit und die
Beschleunigung mit dem Kombisensor.


Computing

Damit der TXT die Drehgeschwindigkeit
selbst steuern und schrittweise erhÃ¶hen
kann, montieren wir unter dem Controller
einen XS-Motor mit U-Getriebe (31068,
31078) so, dass die Getriebeachse nach
unten zeigt (Abb. 21).

Die Achse befestigen wir auf einer Experimentierplatte 500 (32985), den XS-Motor
schlieÃŸen wir an den M1-Ausgang des TXT
an.
Jetzt mÃ¼ssen wir den (sich drehenden) TXT
noch mit Strom versorgen. DafÃ¼r kÃ¶nnen
wir entweder einen Akku ergÃ¤nzen (zu viel
Gewicht), einen fischertechnik-Schleifring
(31301) aus den em-KÃ¤sten der 60er Jahre
verwenden (fÃ¼hrt leider gelegentlich zu
kurzzeitigen Unterbrechungen der Stromversorgung, wodurch der TXT neu bootet)
oder den Versuchsaufbau um Thomas PÃ¼ttmanns genialen â€Selbstenttwisterâ€œ erweitern [14] (macht leider den Aufbau wackelig, was die Messwerte verfÃ¤lscht). Da wir
die Messung nur fÃ¼r rund 20 Umdrehungen
durchfÃ¼hren, kÃ¶nnen wir stattdessen ein
langes fischertechnik-Kabel verwenden und
in Kauf nehmen, dass es sich verdrillt.
Damit wir die Sensorwerte auf dem ROBO
Pro-Oszilloskop anzeigen lassen kÃ¶nnen,
verbinden wir den TXT via WLAN und
lassen uns die gewÃ¼nschten Werte â€“Winkelgeschwindigkeit der x- und Beschleunigung der y-Achse â€“ kabellos Ã¼bermitteln.





Die Messergebnisse in Abb. 23 zeigen den
steilen Anstieg der Beschleunigung (gelb)
auf ca. 0,99ğ‘” innerhalb von 12 Sekunden,
wÃ¤hrend die Winkelgeschwindigkeit (grÃ¼n)
linear auf etwa 670Â°/s (knapp zwei U/s)
steigt.

Ungenauigkeit steckt jedoch in unserer
Rechnung: die Position des Gyrosensors im
3 cm breiten SensorgehÃ¤use habe ich
geraten; von ihr hÃ¤ngt die exakte GrÃ¶ÃŸe des
Radius ğ‘Ÿ ab.
Mit dem Sensor kÃ¶nnen wir nun eine Zentrifuge fÃ¼r das Astronautentraining unserer
fischertechnik-Figuren exakt ausmessen â€“
konstruiert wurde sie ja schon einmal [15].
Aber auch ein Segway (oder â€inverses Pendelâ€œ [16]) rÃ¼ckt in den Bereich des MÃ¶glichen â€“ mehr dazu in einem eigenen Beitrag.
Alle ROBO Pro-Programme aus diesem
Beitrag findet ihr auf der Webseite der
ft:pedia zum Download.

Referenzen

Zentripetalbeschleunigung [Skala:1s/100mg]
(Winkelgeschwindigkeit, Beschleunigung)

FÃ¼r das VerhÃ¤ltnis der Winkelgeschwindigkeit ğœ” zur Zentripetalbeschleunigung ğ‘ğ‘§
gilt:
ğœ”2
ğ‘ğ‘§ =
ğ‘Ÿ
Dabei ist ğ‘Ÿ der Abstand des Sensors zum
Mittelpunkt der Drehachse. In unserem
Modell ist ğ‘Ÿ â‰ˆ 7 cm. In unserem Versuch
wÃ¤chst ğœ” auf etwa 670 Â°/s; das entspricht
einer Geschwindigkeit von
670 cm
cm
â‰ˆ 81,86
360 s
s
Daraus errechnet sich eine Zentripetalbem
schleunigung von 9,57 2 . Der Wert unserer
2ğœ‹ âˆ™ ğ‘Ÿ âˆ™

s

m

Messung liegt mit 9,7 s2 (genauer: 0,99 âˆ™
m

9,81 s2 ) nicht sehr weit entfernt. Eine

[1]

fischertechnik: Kombisensor Art.-Nr.
158402 3-in-1 Orientierungssensor.
Kurzanleitung, 09.06.2017.

[2]

Bosch: BMX055. Small, versatile 9axis sensor module. Data Sheet.
Revision 1.1, 07.11.2014.

[3]

Wikipedia: Inertiale Messeinheit.

[4]

Dirk Fox, Thomas PÃ¼ttmann:
Technikgeschichte mit fischertechnik.
dpunkt-Verlag, Heidelberg, 2015.

[5]

Dirk Fox: IÂ²C mit dem TX â€“ Teil 4:
Nunchuk-Fernsteuerung. 2/2013, S. 41â€“49.

[6]

Dirk Fox: fischertechnik-Roboter mit
Arduino (Teil 1): Smartphone-Steuerung Ã¼ber BLE. ft:pedia 3/2020,
S. 93â€“100.

[7]

Dirk Fox: IÂ²C mit dem TX â€“ Teil 10:
Kompass-Sensoren. ft:pedia 2/2014,
S. 57â€“64.

[8]

Talat Ozyagcilar: Implementing a
Tilt-Compensated eCompass using
Accelerometer and Magnetometer
Sensors. AN4248, Application Note,
Freescale Semiconductors, Rev. 4.0,
11/2015.

[9]

Mark Pedley: Tilt Sensing Using a
Three-Axis Accelerometer. AN3461,
Application Note, Freescale
Seminconductors, Rev. 6, 03/2013.

[10] Wikipedia: arctan2.
[11] Andrea Vitali: Computing tilt
measurement and tilt-compensated
eCompass. Design Tip DT0058,
STMicroelectronics, v3, 07.01.2021.

Computing

[13] Mark Pedley: Build and Calibrate a
Tilt-Compensating Electronic
Compass. In: Circuit Cellar, Issue
265, 8/2012, S. 1-6.
[14] Thomas PÃ¼ttmann: Selbstenttwistung. ft:pedia 3/2015, S. 20â€“24.
[15] Dirk van Wijngaarden: G Force
Machine. Youtube.
[16] Wikipedia: Inverses Pendel.

[12] Michael J. Caruso: Applications of
Magnetic Sensors for Low Cost
Compass Systems. In: IEEE Symposium on Position Location and Navigation (PLANS), 2000, S. 177-184.


